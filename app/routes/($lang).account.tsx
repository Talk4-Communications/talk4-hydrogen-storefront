import {Link, Outlet, useLoaderData, useLocation, useMatches, useOutlet} from "@remix-run/react";
import {AppLoadContext, defer, json, LoaderArgs, redirect} from "@shopify/remix-oxygen";
import {CACHE_NONE, routeHeaders} from "../data/cache";
import {Customer} from "@shopify/hydrogen/dist/storefront-api-types";
import AvatarPlaceholder from "../components/account/AvatarPlaceholder";
import Talk4Logo from "../../public/talk4Logo.svg";
import avatar from '../../public/Images/avatar.png'


type TmpRemixFix = ReturnType<typeof defer<{isAuthenticated: false}>>;

export const headers = routeHeaders;


export async function loader({request, context, params}: LoaderArgs) {
    const {pathname} = new URL(request.url);
    const lang = params.lang;
    const customerAccessToken = await context.session.get('customerAccessToken');
    const isAuthenticated = Boolean(customerAccessToken);
    const loginPath = lang ? `/${lang}/account/login` : '/account/login';
    const isAccountPage = /\/account\/?$/.test(pathname);

    if (!isAuthenticated) {
        if (isAccountPage) {
            return redirect(loginPath) as unknown as TmpRemixFix;
        }
        // pass through to public routes
        return json({isAuthenticated: false}) as unknown as TmpRemixFix;
    }

    const customer = await getCustomer(context, customerAccessToken);

    return defer(
        {
            isAuthenticated,
            customer,
        },
        {
            headers: {
                'Cache-Control': CACHE_NONE,
            },
        },
    );
}
interface Account {
    customer: Customer;
    isAuthenticated: Boolean
}

export default function Authenticated(){
    const data = useLoaderData();
    // const outlet = useOutlet();
    // const matches = useMatches();

    return <Account {...(data as Account)}></Account>
}

function Account({customer,isAuthenticated}:Account){

    const location = useLocation();

    const isActive = (pathname) => {
        return location.pathname.endsWith(pathname) ? 'border-r-2 border-pink text-pink fill-pink' : '';
    };

    return(
        <div>
            {!isAuthenticated && <Outlet></Outlet>}
            {isAuthenticated &&
                <div className="flex min-h-screen">
                    <div className="basis-1/6 bg-white min-w-max">
                        <div className="flex flex-col items-center justify-center space-y-3">
                            <div className="m-7">
                                <img src={Talk4Logo} alt={"Talk4Logo"}/>
                            </div>

                            <div className=" m-7">
                                <AvatarPlaceholder image={avatar} height="h-28" width="w-28"></AvatarPlaceholder>
                                <p className="font-gt-pro font-medium text-center text-md m-2">
                                    {customer.firstName} {customer.lastName}
                                </p>
                                <p className="font-gt-pro text-[11px] text-center text-grey">
                                    <Link className="hover:text-pink" to="/account/register">
                                        View Profile
                                    </Link>
                                </p>
                            </div>

                            <div className="flex-1 w-full">
                                <ul className="py-4 space-y-2 text-sm font-medium font-gt-pro">
                                    <li className="rounded-sm pl-3 pb-3 pt-3 hover:bg-offwhite">
                                        <a
                                            href="/account"
                                            className={`flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink ${isActive('/account')}`}
                                        >
                                            <svg className="w-5 h-5" viewBox="0 0 20 20" >
                                                <path xmlns="http://www.w3.org/2000/svg"  d="M4.25 11C8.319 11 8.5 12.38 8.5 15.25C8.5 16.688 8.5 17.711 7.896 18.46C7.201 19.323 5.936 19.5 4.25 19.5C2.564 19.5 1.299 19.323 0.604 18.46C0 17.711 0 16.689 0 15.275L0.75 15.25H0C0 12.38 0.181 11 4.25 11ZM15.25 11C19.319 11 19.5 12.38 19.5 15.25C19.5 16.688 19.5 17.711 18.896 18.46C18.201 19.323 16.936 19.5 15.25 19.5C13.564 19.5 12.299 19.323 11.604 18.46C11 17.711 11 16.689 11 15.275L11.75 15.25H11C11 12.38 11.181 11 15.25 11ZM4.45616 12.5004L4.25 12.5C1.64103 12.5 1.50723 12.6872 1.50037 14.8771L1.50079 15.7302C1.50553 16.6011 1.53871 17.2303 1.771 17.52C2.036 17.848 2.823 18 4.25 18C5.677 18 6.464 17.847 6.729 17.519C7 17.182 7 16.382 7 15.274C7 12.7738 7 12.5122 4.45616 12.5004ZM15.4562 12.5004L15.25 12.5C12.641 12.5 12.5072 12.6872 12.5004 14.8771L12.5008 15.7302C12.5055 16.6011 12.5387 17.2303 12.771 17.52C13.036 17.848 13.823 18 15.25 18C16.677 18 17.464 17.847 17.729 17.519C18 17.182 18 16.382 18 15.274C18 12.7738 18 12.5122 15.4562 12.5004ZM4.25 0C8.319 0 8.5 1.38 8.5 4.25C8.5 5.688 8.5 6.711 7.896 7.46C7.201 8.323 5.936 8.5 4.25 8.5C2.564 8.5 1.299 8.323 0.604 7.46C0 6.711 0 5.689 0 4.275L0.75 4.25H0C0 1.38 0.181 0 4.25 0ZM15.25 0C19.319 0 19.5 1.38 19.5 4.25C19.5 5.688 19.5 6.711 18.896 7.46C18.201 8.323 16.936 8.5 15.25 8.5C13.564 8.5 12.299 8.323 11.604 7.46C11 6.711 11 5.689 11 4.275L11.75 4.25H11C11 1.38 11.181 0 15.25 0ZM4.45616 1.50045L4.25 1.5C1.64103 1.5 1.50723 1.68721 1.50037 3.87705L1.50079 4.73018C1.50553 5.60114 1.53871 6.23029 1.771 6.52C2.036 6.848 2.823 7 4.25 7C5.677 7 6.464 6.847 6.729 6.519C7 6.182 7 5.382 7 4.274C7 1.7738 7 1.51222 4.45616 1.50045ZM15.4562 1.50045L15.25 1.5C12.641 1.5 12.5072 1.68721 12.5004 3.87705L12.5008 4.73018C12.5055 5.60114 12.5387 6.23029 12.771 6.52C13.036 6.848 13.823 7 15.25 7C16.677 7 17.464 6.847 17.729 6.519C18 6.182 18 5.382 18 4.274C18 1.7738 18 1.51222 15.4562 1.50045Z"/>
                                            </svg>
                                            <span>Dashboard</span>
                                        </a>
                                    </li>

                                    <li className="rounded-sm pl-3 pb-3 pt-3 hover:bg-offwhite">
                                        <a
                                            href="/account/billing"
                                            className={`flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink ${isActive('/billing')}`}
                                        >
                                            <svg className="w-5 h-5" viewBox="0 0 19 20" >
                                                <path xmlns="http://www.w3.org/2000/svg" d="M12.9088 0C16.0528 0 18.1648 2.153 18.1648 5.357V14.553C18.1648 17.785 16.1178 19.887 12.9498 19.907L5.25676 19.91C2.11276 19.91 -0.000244141 17.757 -0.000244141 14.553V5.357C-0.000244141 2.124 2.04676 0.023 5.21476 0.004L12.9078 0H12.9088ZM12.9088 1.5L5.21976 1.504C2.89176 1.518 1.49976 2.958 1.49976 5.357V14.553C1.49976 16.968 2.90476 18.41 5.25576 18.41L12.9448 18.407C15.2728 18.393 16.6648 16.951 16.6648 14.553V5.357C16.6648 2.942 15.2608 1.5 12.9088 1.5ZM12.7159 13.4737C13.1299 13.4737 13.4659 13.8097 13.4659 14.2237C13.4659 14.6377 13.1299 14.9737 12.7159 14.9737H5.49586C5.08186 14.9737 4.74586 14.6377 4.74586 14.2237C4.74586 13.8097 5.08186 13.4737 5.49586 13.4737H12.7159ZM12.7159 9.2872C13.1299 9.2872 13.4659 9.6232 13.4659 10.0372C13.4659 10.4512 13.1299 10.7872 12.7159 10.7872H5.49586C5.08186 10.7872 4.74586 10.4512 4.74586 10.0372C4.74586 9.6232 5.08186 9.2872 5.49586 9.2872H12.7159ZM8.25056 5.1104C8.66456 5.1104 9.00056 5.4464 9.00056 5.8604C9.00056 6.2744 8.66456 6.6104 8.25056 6.6104H5.49556C5.08156 6.6104 4.74556 6.2744 4.74556 5.8604C4.74556 5.4464 5.08156 5.1104 5.49556 5.1104H8.25056Z" />
                                            </svg>
                                            <span>Billing & Payment</span>
                                        </a>
                                    </li>

                                    <li className="rounded-sm pl-3 pb-3 pt-3 hover:bg-offwhite">
                                        <a
                                            href="/account/orders"
                                            className={`flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink ${isActive('/orders')}`}
                                        >
                                            <svg className="w-5 h-5" viewBox="0 0 21 20" >
                                                <path xmlns="http://www.w3.org/2000/svg" d="M5.54339 16.9519C6.25739 16.9519 6.83839 17.5319 6.83839 18.2459C6.83839 18.9599 6.25739 19.5409 5.54339 19.5409C4.82939 19.5409 4.24939 18.9599 4.24939 18.2459C4.24939 17.5319 4.82939 16.9519 5.54339 16.9519ZM16.8237 16.9519C17.5387 16.9519 18.1197 17.5319 18.1197 18.2459C18.1197 18.9599 17.5387 19.5409 16.8237 19.5409C16.1097 19.5409 15.5297 18.9599 15.5297 18.2459C15.5297 17.5319 16.1097 16.9519 16.8237 16.9519ZM1.26759 0.00948704L3.34759 0.369487C3.68259 0.428487 3.93759 0.706487 3.96659 1.04649L4.20159 3.84749L5.07544 3.84786C5.21804 3.84793 5.35913 3.84799 5.49871 3.84805L7.10302 3.84882C7.2309 3.84888 7.35735 3.84894 7.48238 3.84901L9.25378 3.84998C9.36506 3.85004 9.47501 3.85011 9.58364 3.85018L10.825 3.85097C10.9233 3.85103 11.0204 3.8511 11.1163 3.85117L12.2081 3.85197C12.2943 3.85204 12.3793 3.85211 12.4632 3.85217L13.4151 3.85299C13.49 3.85306 13.5638 3.85313 13.6365 3.8532L14.2621 3.85382C14.3285 3.85389 14.3939 3.85396 14.4582 3.85403L15.1828 3.85487C15.2393 3.85494 15.2949 3.85501 15.3495 3.85508L15.9613 3.85594C16.0087 3.85601 16.0552 3.85608 16.101 3.85615L16.4898 3.8568C16.5305 3.85687 16.5704 3.85695 16.6096 3.85702L17.0427 3.8579C17.0758 3.85797 17.1082 3.85804 17.1399 3.85812L17.4065 3.85878C17.4341 3.85886 17.461 3.85893 17.4873 3.85901L17.773 3.85991C17.7945 3.85998 17.8153 3.86006 17.8356 3.86014L18.0034 3.86082C18.0204 3.8609 18.037 3.86097 18.053 3.86105L18.2227 3.86197C18.2351 3.86205 18.247 3.86213 18.2584 3.86221L18.351 3.86291C18.3601 3.86299 18.3688 3.86307 18.3772 3.86314L18.4438 3.86385C18.4503 3.86393 18.4564 3.86401 18.4623 3.86409L18.5076 3.86481C18.5118 3.86489 18.5159 3.86497 18.5197 3.86505L18.5483 3.86578C18.551 3.86586 18.5534 3.86594 18.5557 3.86602L18.5764 3.867L18.58 3.86725C18.5897 3.86815 18.5926 3.86849 18.5926 3.86849C19.1496 3.94949 19.6396 4.24049 19.9736 4.68849C20.3076 5.13549 20.4476 5.68649 20.3676 6.23849L19.4186 12.7965C19.2396 14.0445 18.1556 14.9855 16.8956 14.9855H5.97459C4.65759 14.9855 3.54259 13.9575 3.43559 12.6425L2.51959 1.74849L1.01259 1.48849C0.603593 1.41649 0.330593 1.02949 0.400593 0.620487C0.472593 0.211487 0.867593 -0.054513 1.26759 0.00948704ZM4.87483 5.34783L4.32759 5.34749L4.93059 12.5195C4.97459 13.0715 5.42559 13.4855 5.97659 13.4855H16.8936C17.4146 13.4855 17.8596 13.0975 17.9336 12.5825L18.8836 6.02349C18.9056 5.86749 18.8666 5.71149 18.7716 5.58549C18.6776 5.45849 18.5396 5.37649 18.3836 5.35449C18.3764 5.35476 18.3591 5.35502 18.3323 5.35524L18.2235 5.35587C18.2008 5.35596 18.1757 5.35605 18.1485 5.35613L17.582 5.35699C17.5342 5.35702 17.4845 5.35705 17.433 5.35708L16.101 5.35702C16.0267 5.357 15.9509 5.35696 15.8739 5.35693L14.3538 5.35601C14.2627 5.35594 14.1706 5.35587 14.0776 5.3558L13.2175 5.35511C13.1195 5.35503 13.0208 5.35495 12.9214 5.35486L12.0103 5.35406C11.9074 5.35397 11.8041 5.35387 11.7002 5.35378L11.0727 5.3532C10.9674 5.35311 10.8617 5.35301 10.7559 5.35291L9.79819 5.35201C9.69141 5.35191 9.58456 5.35181 9.47771 5.35171L8.83706 5.35112C8.73044 5.35102 8.62395 5.35092 8.51764 5.35082L7.88243 5.35025C7.77709 5.35015 7.67205 5.35006 7.56738 5.34997L6.63687 5.34917C6.53495 5.34908 6.43357 5.349 6.33281 5.34892L5.15688 5.34802C5.06199 5.34795 4.96795 5.34789 4.87483 5.34783ZM15.2875 7.54379C15.7015 7.54379 16.0375 7.87979 16.0375 8.29379C16.0375 8.70779 15.7015 9.04379 15.2875 9.04379H12.5155C12.1005 9.04379 11.7655 8.70779 11.7655 8.29379C11.7655 7.87979 12.1005 7.54379 12.5155 7.54379H15.2875Z"/>
                                            </svg>

                                            <span>Orders</span>
                                        </a>
                                    </li>

                                    <li className="rounded-sm pl-3 pb-3 pt-3 hover:bg-offwhite">
                                        <a
                                            href="/account/settings/switchproviders"
                                            className={`flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink ${isActive('/settings')}  ${isActive('/switchproviders')} ${isActive('/leavetalk4')}`}
                                            // className="flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink"
                                        >

                                            <svg className="w-5 h-5" viewBox="0 0 24 24">
                                                <path  xmlns="http://www.w3.org/2000/svg" d="M12.2673 2C12.9833 2 13.6793 2.294 14.1783 2.805C14.6763 3.319 14.9513 4.024 14.9303 4.739C14.9323 4.9 14.9853 5.086 15.0813 5.249C15.2403 5.519 15.4913 5.709 15.7893 5.787C16.0873 5.861 16.3993 5.821 16.6643 5.664C17.9443 4.933 19.5733 5.371 20.3043 6.641L20.9273 7.72C20.9433 7.749 20.9573 7.777 20.9693 7.806C21.6313 9.057 21.1893 10.632 19.9593 11.351C19.7803 11.454 19.6353 11.598 19.5353 11.772C19.3803 12.041 19.3373 12.361 19.4153 12.655C19.4953 12.955 19.6863 13.204 19.9553 13.358C20.5623 13.707 21.0153 14.295 21.1963 14.974C21.3773 15.652 21.2783 16.388 20.9253 16.995L20.2613 18.101C19.5303 19.357 17.9013 19.792 16.6343 19.06C16.4653 18.963 16.2703 18.91 16.0763 18.905H16.0703C15.7813 18.905 15.4843 19.028 15.2683 19.243C15.0493 19.462 14.9293 19.754 14.9313 20.064C14.9243 21.533 13.7293 22.721 12.2673 22.721H11.0143C9.54532 22.721 8.35032 21.527 8.35032 20.058C8.34832 19.877 8.29632 19.689 8.19932 19.526C8.04232 19.252 7.78832 19.056 7.49532 18.978C7.20432 18.9 6.88532 18.943 6.62332 19.095C5.99532 19.445 5.25632 19.53 4.58032 19.34C3.90532 19.149 3.32232 18.685 2.98032 18.07L2.35532 16.993C1.62432 15.725 2.05932 14.1 3.32532 13.368C3.68432 13.161 3.90732 12.775 3.90732 12.361C3.90732 11.947 3.68432 11.56 3.32532 11.353C2.05832 10.617 1.62432 8.988 2.35432 7.72L3.03232 6.607C3.75332 5.353 5.38332 4.911 6.65432 5.641C6.82732 5.744 7.01532 5.796 7.20632 5.798C7.82932 5.798 8.35032 5.284 8.36032 4.652C8.35632 3.955 8.63132 3.286 9.13232 2.781C9.63532 2.277 10.3033 2 11.0143 2H12.2673ZM12.2673 3.5H11.0143C10.7043 3.5 10.4143 3.621 10.1953 3.839C9.97732 4.058 9.85832 4.349 9.86032 4.659C9.83932 6.121 8.64432 7.298 7.19732 7.298C6.73332 7.293 6.28632 7.168 5.89832 6.936C5.35332 6.626 4.64132 6.817 4.32232 7.372L3.64532 8.485C3.33532 9.023 3.52532 9.734 4.07732 10.055C4.89632 10.529 5.40732 11.413 5.40732 12.361C5.40732 13.309 4.89632 14.192 4.07532 14.667C3.52632 14.985 3.33632 15.692 3.65432 16.242L4.28532 17.33C4.44132 17.611 4.69632 17.814 4.99132 17.897C5.28532 17.979 5.60932 17.944 5.87932 17.794C6.27632 17.561 6.73832 17.44 7.20232 17.44C7.43132 17.44 7.66032 17.469 7.88432 17.529C8.56032 17.711 9.14732 18.163 9.49532 18.77C9.72132 19.151 9.84632 19.596 9.85032 20.05C9.85032 20.7 10.3723 21.221 11.0143 21.221H12.2673C12.9063 21.221 13.4283 20.703 13.4313 20.064C13.4273 19.358 13.7033 18.687 14.2083 18.182C14.7063 17.684 15.4023 17.385 16.0983 17.405C16.5543 17.416 16.9933 17.539 17.3803 17.759C17.9373 18.078 18.6483 17.888 18.9703 17.338L19.6343 16.231C19.7823 15.976 19.8253 15.656 19.7463 15.361C19.6683 15.066 19.4723 14.81 19.2083 14.659C18.5903 14.303 18.1493 13.729 17.9663 13.041C17.7853 12.366 17.8843 11.629 18.2373 11.022C18.4673 10.622 18.8043 10.285 19.2083 10.053C19.7503 9.736 19.9403 9.027 19.6253 8.475C19.6123 8.453 19.6003 8.43 19.5903 8.406L19.0043 7.39C18.6853 6.835 17.9753 6.644 17.4183 6.961C16.8163 7.317 16.1003 7.419 15.4123 7.238C14.7253 7.06 14.1493 6.625 13.7903 6.011C13.5603 5.627 13.4353 5.18 13.4313 4.725C13.4403 4.383 13.3203 4.076 13.1023 3.851C12.8853 3.627 12.5803 3.5 12.2673 3.5ZM11.6452 8.9741C13.5122 8.9741 15.0312 10.4941 15.0312 12.3611C15.0312 14.2281 13.5122 15.7461 11.6452 15.7461C9.77822 15.7461 8.25922 14.2281 8.25922 12.3611C8.25922 10.4941 9.77822 8.9741 11.6452 8.9741ZM11.6452 10.4741C10.6052 10.4741 9.75922 11.3211 9.75922 12.3611C9.75922 13.4011 10.6052 14.2461 11.6452 14.2461C12.6852 14.2461 13.5312 13.4011 13.5312 12.3611C13.5312 11.3211 12.6852 10.4741 11.6452 10.4741Z"/>
                                            </svg>

                                            <span>Settings</span>
                                        </a>
                                    </li>

                                    <li className="rounded-sm pl-3 pb-3 pt-3 hover:bg-offwhite">
                                        <a
                                            href="/account/logout"
                                            className={`flex items-center p-2 space-x-3 rounded-sm hover:border-r-2 hover:border-pink hover:text-pink hover:fill-pink ${isActive('/logout')}`}
                                        >
                                            <svg className="w-5 h-5" viewBox="0 0 24 24" >
                                                <path xmlns="http://www.w3.org/2000/svg" d="M11.3082 2C13.7542 2 15.7442 3.99 15.7442 6.436V7.368C15.7442 7.782 15.4082 8.118 14.9942 8.118C14.5802 8.118 14.2442 7.782 14.2442 7.368V6.436C14.2442 4.816 12.9272 3.5 11.3082 3.5H6.43324C4.81624 3.5 3.50024 4.816 3.50024 6.436V17.565C3.50024 19.184 4.81624 20.5 6.43324 20.5H11.3192C12.9312 20.5 14.2442 19.188 14.2442 17.576V16.633C14.2442 16.219 14.5802 15.883 14.9942 15.883C15.4082 15.883 15.7442 16.219 15.7442 16.633V17.576C15.7442 20.016 13.7582 22 11.3192 22H6.43324C3.98924 22 2.00024 20.011 2.00024 17.565V6.436C2.00024 3.99 3.98924 2 6.43324 2H11.3082ZM19.3883 8.554L22.3163 11.469C22.3425 11.4949 22.3659 11.5219 22.3873 11.5504L22.3163 11.469C22.3518 11.5039 22.3833 11.5421 22.4106 11.5828C22.4227 11.6012 22.4343 11.6203 22.445 11.6399C22.4537 11.6552 22.4618 11.6712 22.4692 11.6875C22.4755 11.7018 22.4816 11.7162 22.4872 11.7308C22.4948 11.7498 22.5014 11.7693 22.5071 11.7891C22.5115 11.8047 22.5155 11.8203 22.519 11.836C22.5235 11.8551 22.527 11.8743 22.5298 11.8937C22.5314 11.9063 22.5329 11.9195 22.5341 11.9328C22.5364 11.9556 22.5373 11.9777 22.5373 12L22.5322 12.062L22.5302 12.1017C22.53 12.1034 22.5297 12.1051 22.5295 12.1068L22.5373 12C22.5373 12.0555 22.5312 12.1105 22.5193 12.1639C22.5155 12.1797 22.5115 12.1953 22.507 12.2107C22.5014 12.2307 22.4948 12.2502 22.4874 12.2695C22.4816 12.2838 22.4755 12.2982 22.469 12.3123C22.4618 12.3288 22.4537 12.3448 22.4451 12.3605C22.4343 12.3797 22.4227 12.3988 22.4102 12.4172C22.4032 12.4282 22.3955 12.439 22.3875 12.4497C22.3637 12.481 22.3378 12.5104 22.3097 12.5377L19.3883 15.447C19.2423 15.593 19.0503 15.666 18.8593 15.666C18.6673 15.666 18.4743 15.593 18.3283 15.445C18.0363 15.151 18.0373 14.677 18.3303 14.385L19.9702 12.75H9.74604C9.33204 12.75 8.99604 12.414 8.99604 12C8.99604 11.586 9.33204 11.25 9.74604 11.25H19.9722L18.3303 9.616C18.0373 9.324 18.0353 8.85 18.3283 8.556C18.6203 8.262 19.0943 8.262 19.3883 8.554Z"/>
                                            </svg>

                                            <span>Logout</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div className="basis-5/6 bg-offwhite">
                        <div className=" flex flex-col">
                            <div className=" flex justify-end w-full h-24 shadow-lg items-center">
                                <div className="flex items-center space-x-3 mr-6">
                                    <div>
                                        <AvatarPlaceholder image={avatar} height="h-12" width="w-12"></AvatarPlaceholder>
                                    </div>
                                    <div>
                                        <p className="font-gt-pro font-medium text-center text-sm">
                                            {customer.firstName} {customer.lastName}
                                        </p>
                                        <p className="font-gt-pro text-[11px] text-center text-grey">
                                            <Link className="hover:text-pink" to="/account/register">
                                                View Profile
                                            </Link>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <Outlet></Outlet>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

    )
}

export async function getCustomer(
    context: AppLoadContext,
    customerAccessToken: string,
) {
    const {storefront} = context;

    const data = await storefront.query<{
        customer: Customer;
    }>(CUSTOMER_QUERY, {
        variables: {
            customerAccessToken,
            country: context.storefront.i18n.country,
            language: context.storefront.i18n.language,
        },
    });

    /**
     * If the customer failed to load, we assume their access token is invalid.
     */
    if (!data || !data.customer) {
        // throw await doLogout(context);
    }

    return data.customer;
}

const CUSTOMER_QUERY = `#graphql
  query CustomerDetails(
    $customerAccessToken: String!
    $country: CountryCode
    $language: LanguageCode
  ) @inContext(country: $country, language: $language) {
    customer(customerAccessToken: $customerAccessToken) {
      firstName
      lastName
      phone
      email
      defaultAddress {
        id
        formatted
        firstName
        lastName
        company
        address1
        address2
        country
        province
        city
        zip
        phone
      }
    }
  }
`;